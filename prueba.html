<head>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<div id="campoTexto" contenteditable="true" style="border: 1px solid #ccc; padding: 5px; min-height: 100px;">
  Escribe texto aqui...
</div>
<div id="resultado"></div>
<button onclick="applyFormat()">Aplicar Formato</button>
<select id="sugerencias" style="display: none;"></select>
<button id="botonVerificar">Verificar Ortografía</button>
<div id="mensajeError" style="color: red;"></div>
<script>
  // Espera a que el documento esté listo
  $(document).ready(function () {
  $("#botonVerificar").click(async function () {
    var tiempoInicial = new Date();
    var texto = $("#campoTexto").text().trim();
    var posiblesReemplazosTabla = [];

    try {
      var data = await hacerSolicitudAjax(texto);
      var matches = data.matches;

      for (let i = 0; i < matches.length; i++) {
        var context = matches[i].context;
        var palabraErronea = context.text.substring(context.offset, context.offset + context.length);
        var posiblesReemplazos = [palabraErronea];

        for (var j = 0; j < matches[i].replacements.length; j++) {
          var replacement = matches[i].replacements[j];
          posiblesReemplazos.push(replacement.value);
        }

        posiblesReemplazosTabla.push(posiblesReemplazos);
      }

      // Llamar a eliminarDuplicados dentro de esta función
      posiblesReemplazosTabla = eliminarDuplicados(posiblesReemplazosTabla);
      imprimeCorrecciones(texto, posiblesReemplazosTabla);
    } catch (error) {
      console.error("Error en la solicitud AJAX: " + error);
    }
  });
});

function hacerSolicitudAjax(texto) {
  return new Promise(function (resolve, reject) {
    $.get("https://api.languagetool.org/v2/check", { text: texto, language: "es" })
      .done(function (data) {
        resolve(data);
      })
      .fail(function (error) {
        reject(error);
      });
  });
}


  function imprimeCorrecciones(texto, tabla) {
    for (let i = 0; i < tabla.length; i++) {
      const opciones = tabla[i];
      var selectHTML = "<select style='background-color: #ff9999; border-radius: 5px;'>";
      console.log(opciones.length)
      for (var j = 0; j < opciones.length; j++) {
        selectHTML += "<option value='" + opciones[j] + "'>" + opciones[j] + "</option>";
        console.log(opciones[j])
      }
      selectHTML += "</select>";
      texto = replaceAll(texto, tabla[i][0], selectHTML)
    }
    $("#resultado").html(texto);
  }


  function replaceAll(input, find, replace) {
    return input.split(find).join(replace);
  }

  function eliminarDuplicados(arr) {
    const objetoUnico = {};
    const resultado = [];

    for (let i = 0; i < arr.length; i++) {
      const elementoSerializado = JSON.stringify(arr[i]);
      if (!objetoUnico[elementoSerializado]) {
        objetoUnico[elementoSerializado] = true;
        resultado.push(arr[i]);
      }
    }

    return resultado;
  }
</script>
